#!/usr/bin/env ruby

require 'benchmark'
require 'bio-maf'
require 'optparse'
require 'ostruct'

def build_index(maf, index)
  parser = Bio::MAF::Parser.new(maf)
  idx = Bio::MAF::KyotoIndex.build(parser, index)
  idx.close
end

#### script

options = OpenStruct.new

op = OptionParser.new do |opts|
  opts.banner = "Usage: maf_index [options] <maf> <index>"
  #opts.separator ""
  #opts.separator "Options:"
  opts.on("--time", "print elapsed time") do
    options.bench = true
  end
end

op.parse!(ARGV)

maf_p = ARGV.shift
index_p = ARGV.shift

unless maf_p && index_p
  $stderr.puts op
  exit 1
end

if ! options.bench
  build_index(maf_p, index_p)
else
  bm_res = Benchmark.measure do
    build_index(maf_p, index_p)
  end
  puts bm_res
end
